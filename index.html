<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Descartes</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --error-color: #dc2626;
            --success-color: #16a34a;
        }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 600px;
            margin: 2rem auto;
            padding: 0 1rem;
            background-color: #f8fafc;
        }

        .container {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #1f2937;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #1d4ed8;
        }

        .error {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .success {
            color: var(--success-color);
            text-align: center;
            padding: 1rem;
            margin-top: 1rem;
            background-color: #dcfce7;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Registro de Descartes</h2>
        <form id="productoForm">
            <div class="form-group">
                <label for="fecha">Fecha:</label>
                <input type="date" id="fecha" name="fecha" required>
                <div class="error" id="fecha-error"></div>
            </div>

            <div class="form-group">
                <label for="turno">Turno:</label>
                <select id="turno" name="turno" required>
                    <option value="">Seleccione turno</option>
                    <option value="DIA">DÍA</option>
                    <option value="NOCHE">NOCHE</option>
                </select>
                <div class="error" id="turno-error"></div>
            </div>

            <div class="form-group">
                <label for="codigoProducto">Código de Producto:</label>
                <input type="text" id="codigoProducto" name="codigoProducto" required pattern="[A-Za-z0-9-]+" title="Solo letras, números y guiones">
                <div class="error" id="codigoProducto-error"></div>
            </div>

            <div class="form-group">
                <label for="numeroOrden">Número de Orden:</label>
                <input type="text" id="numeroOrden" name="numeroOrden" required pattern="[A-Za-z0-9-]+" title="Solo letras, números y guiones">
                <div class="error" id="numeroOrden-error"></div>
            </div>

            <div class="form-group">
                <label for="tolerado">Tolerado:</label>
                <input type="number" id="tolerado" name="tolerado" required min="0" step="0.01">
                <div class="error" id="tolerado-error"></div>
            </div>

            <div class="form-group">
                <label for="descarteTotal">Descarte Total:</label>
                <input type="number" id="descarteTotal" name="descarteTotal" required min="0" step="0.01">
                <div class="error" id="descarteTotal-error"></div>
            </div>

            <div class="form-group">
                <label for="observacion">Observación:</label>
                <input type="text" id="observacion" name="observacion">
            </div>

            <div class="form-group">
                <label for="vistoBueno">Visto Bueno:</label>
                <input type="text" id="vistoBueno" name="vistoBueno">
            </div>

            <button type="submit">Registrar Descarte</button>
        </form>
        <div id="mensaje"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.js"></script>
    <script>
        function showToast(message, isError = false) {
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: isError ? "#dc2626" : "#16a34a",
            }).showToast();
        }

        function validateForm() {
            let isValid = true;
            const fields = ['fecha', 'turno', 'codigoProducto', 'numeroOrden', 'tolerado', 'descarteTotal'];
            
            fields.forEach(field => {
                const element = document.getElementById(field);
                const errorElement = document.getElementById(`${field}-error`);
                
                if (!element.value) {
                    errorElement.textContent = 'Este campo es obligatorio';
                    isValid = false;
                } else {
                    errorElement.textContent = '';
                }
            });

            const tolerado = parseFloat(document.getElementById('tolerado').value);
            const descarteTotal = parseFloat(document.getElementById('descarteTotal').value);

            if (descarteTotal < tolerado) {
                document.getElementById('descarteTotal-error').textContent = 'El descarte total no puede ser menor que el tolerado';
                isValid = false;
            }

            return isValid;
        }

        document.getElementById('productoForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            if (!validateForm()) {
                showToast('Por favor, corrija los errores en el formulario', true);
                return;
            }

            const formData = {
                fecha: document.getElementById('fecha').value,
                turno: document.getElementById('turno').value,
                codigoProducto: document.getElementById('codigoProducto').value,
                numeroOrden: document.getElementById('numeroOrden').value,
                tolerado: document.getElementById('tolerado').value,
                descarteTotal: document.getElementById('descarteTotal').value,
                observacion: document.getElementById('observacion').value,
                vistoBueno: document.getElementById('vistoBueno').value
            };

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbx_oXdmjP23CFKie1jez5xuywiB0pHOuZim_gdPQxzdY9432u2XkdPdNpwZ1vCFDEHz5Q/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                showToast('Registro guardado exitosamente');
                document.getElementById('productoForm').reset();
                
            } catch (error) {
                showToast('Error al enviar los datos: ' + error.message, true);
                console.error('Error:', error);
            }
        });
    </script>
</body>
</html>
